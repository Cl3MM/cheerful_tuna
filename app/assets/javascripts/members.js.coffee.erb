# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/
#jQuery ->

#  $('#member_company').on 'focusout', (event) ->
#    <%#$('#member_user_name').val $(this).val()%>
#    company = $(this).val()
#    if company == ""
#      $(this).focus()
#    else
#      company = company.replace(/\./g, " ")
      #console.log(company)
#      url = '/members/create_user_name/' + company
#      $.post url, (data) ->
#        #console.log(data)
#        $('#member_user_name').val data
#      , "json"
#    false
###

    initSelection: (element, callback) ->
      data = []
      console.log('data')
      console.log $(element.val())
      $(element.val().split(',')).each ->
        data.push({id: this, text: this})
      console.log data
      callback data


###


jQuery ->
  $('#member_category').select2()

  $('#member_country').select2()

  $('#member_contact_ids').select2
#    initSelection: (element, callback) ->
#      bob = $('#member_contact_ids').val()
#      console.log bob
#      callback $.parseJSON(bob)
    placeholder: "Select contact(s)"
    allowClear: true
    minimumInputLength: 3
    multiple: true
    ajax:
      url: "/contacts.json"
      dataType: 'json'
      quietMillis: 100
      data: (term, page) ->
        member_query: term
        page: page
      results: (data, page) ->
        #console.log('result '+  data)
        results: data
    formatResult: (contact) ->
      contact.text
    formatSelection: (data) ->
      data.text
  $('#member_contact_ids').select2("data", $.parseJSON($('#member_contact_ids').val()))
