<%- model_class = Contact.new.class -%>
<div class="page-header">
  <h1><i class="icon-tags"></i> Contacts Statistics</h1>
</div>

<div class="row">

  <div class="span3">
    <h2>Global statistics</h2>
    <dl class="dl-horizontal">
    	<dt>Active contacts</dt>
    	<dd><%= Contact.active_contacts.count %></dd>
      	<dt>Inactive contacts</dt>
      	<dd><%= Contact.inactive_contacts.count %></dd>
        <dt>Emails addresses</dt>
        <dd><%= Email.count %></dd>
    </dl>
  </div>
</div>
<hr />
<div class="row">
  <div class="span10">
    <h2>Last 10 contacts</h2>
      <table class="table table-bordered">
      <thead>
        <tr>
          <th>Company</th>
          <th>Email</th>
          <th>Created by</th>
          <th>Created on</th>
        </tr>
      </thead>
      <tbody>
    <% Contact.last(10).each do |contact| %>
      <tr>
        <td><%= link_to contact.company.truncate(30), contact_path(contact.id) %></td>
        <td><%= contact.emails.first.address.truncate(30) %></td>
        <td><%= User.find_by_id(contact.user_id).username %></td>
        <td><%= contact.created_at.strftime("%d/%m/%y") %></td>
      </tr>
    <% end %>
      </tbody>
    </table>
  </div>
</div>
<hr />
<div class="row">
  <div class="span10">
    <h2>Users weekly activity <small>Week #<%= Date.today.strftime("%W") %>: <%= Date.today.beginning_of_week.strftime("%B, %d") %> to <%= Date.today.end_of_week.strftime("%d, %Y") %></small></h2>
    <%= content_tag :div, "", id: "user_weekly_activity", data: {stats: Contact.draw_chart("week")} %>
    <%#= content_tag :div, "", id: "user_monthly_activity", data: {orders: Order.chart_data} %>
  </div>
</div>
<hr />
<div class="row">
  <div class="span10">
    <h2>Users monthly activity <small><%= Date.today.strftime("%B %Y") %></small></h2>
    <%= content_tag :div, "", id: "user_monthly_activity", data: {stats: Contact.draw_chart} %>
    <%#= content_tag :div, "", id: "user_monthly_activity", data: {orders: Order.chart_data} %>
  </div>
</div>
