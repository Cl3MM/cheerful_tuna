<%- model_class = Contact.new.class -%>
<div class="page-header">
  <h1><i class="icon-user"></i>
    <%=t '.title', :default => model_class.model_name.human.pluralize %>
    <small>{<%= Contact.count %>}</small>
  </h1>
</div>

<div class="well">
  <%= form_tag contacts_path, method: :get, :class=>"form-inline inline" do %>
    <%= select_per_page({selected: @per_page, select_options: %w(50 100 250 500 1000), html_input: {class: "span1", id: "per_page", name: "per_page"}})  %>
    <span  class="help-inline" style="margin-right: 2em;">per page</span>
  <% end -%>
  <%= form_tag contacts_path, method: :get, :class=>"form-inline inline", style: "clear:none;" do %>
    <%= text_field_tag :query, params[:query], :class=>"input-medium" %>
    <%= submit_tag "Search", name: nil, :class=>"btn" %>
    <span  class="help-inline">You can use *, OR, AND operators to refine your query</span>
  <% end -%>
  <%= link_to raw('<i class="icon-plus-sign"></i> New contact'), new_contact_path, :class => 'btn btn-primary pull-right' %>
</div>
<div class="row">
  <div class="span10">
<% if @contacts.empty? %>
  <div class="alert alert-error">
    <strong>
      <i class="icon-exclamation-sign"></i> Sorry, no results :(
    </strong>
  </div>
<% else %>
  <% if @q %>
  <div class="alert alert-info">
    <strong>Search results: <%= "#{pluralize(@contacts.total, 'result')}" %> matching the patern</strong>
  </div>
  <% end %>
  <div class="pagination pagination-centered">
    <%= will_paginate @contacts, :renderer => BootstrapPagination::Rails %>
  </div>
  <%#= paginate @contacts %>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Company</th>
        <th>Email</th>
        <th class="center">Website</th>
        <th>Category</th>
        <th>Country</th>
        <th class="actions">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @contacts.each do |contact| %>
        <tr id="contact_table" value="<%= contact.user_id %>">
          <td><%= link_to contact.company.truncate(22), contact_path(contact) %></td>
          <td>
            <%= h(contact.email_addresses.map{|e| e.truncate(26)}.join("\n")) %>
          </td>
          <td class="center"><%= display_website contact.website %></td>
          <td><%= contact.category.truncate(16) %></td>
          <td><%= contact.country.upcase.truncate(15) %></td>
          <td class="actions">
            <div class="btn-group pull-right">
              <%= link_to raw('<i class="icon-edit"></i>'),
                edit_contact_path(contact), :class => 'btn btn-mini', :title => 'edit contact' %>
              <%= link_to raw('<i class="icon-download"></i>'), contact_path(contact, format: "pdf"), :class => "btn btn-info btn-mini" %>

              <% if contact.is_active %>
                <%= link_to raw('<i class="icon-lock"></i>'), contact_activation_path(contact, deactivate: true), class: "btn btn-warning btn-mini btn-tooltip", title: "Deactivate contact"  %>
              <% else %>
                <%= link_to raw('<i class="icon-ok"></i>'), contact_activation_path(contact, activate: true), class: "btn btn-warning btn-mini btn-tooltip", title: "Activate contact" %>
              <% end %>
              <%= link_to raw('<i class="icon-share"></i>'), duplicate_path(contact),
                class: 'btn btn-mini btn-info', title: "Duplicate this entry" %>
              <% if current_user.is_admin? %>
                <%= link_to raw('<i class="icon-trash icon-white"></i>'),
                  contact_path(contact),
                  :method => :delete,
                  :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?'))},
                  :class => 'btn btn-mini btn-danger' %>
              <% end -%>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="pagination pagination-centered">
    <%= will_paginate @contacts, :renderer => BootstrapPagination::Rails %>
  </div>
<% end -%>
  </div>
</div>
